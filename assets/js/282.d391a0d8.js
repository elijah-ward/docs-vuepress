(window.webpackJsonp=window.webpackJsonp||[]).push([[282],{219:function(e,a,t){"use strict";t.r(a);var r=t(0),n=Object(r.a)({},function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"remote-option-provider"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#remote-option-provider","aria-hidden":"true"}},[e._v("#")]),e._v(" Remote option provider")]),e._v(" "),t("h2",{attrs:{id:"yum-package-list-cgi"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#yum-package-list-cgi","aria-hidden":"true"}},[e._v("#")]),e._v(" Yum package list CGI")]),e._v(" "),t("p",[t("a",{attrs:{href:"http://yum.baseurl.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Yum"),t("OutboundLink")],1),e._v(" is a great tool for automating "),t("a",{attrs:{href:"http://www.rpm.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("RPM"),t("OutboundLink")],1),e._v(" package management. With Yum,\nadministrators can publish packages to the repository and then use the\nyum client tool to automate the installation of packages along with\ntheir declared dependencies. Yum includes a command\ncalled "),t("a",{attrs:{href:"http://linux.die.net/man/1/repoquery",target:"_blank",rel:"noopener noreferrer"}},[e._v("repoquery"),t("OutboundLink")],1),e._v(" useful for\nquerying Yum repositories similarly to rpm queries.")]),e._v(" "),t("p",[e._v("Acme Anvils set up their own Yum repository to distribute application release\npackages. The Acme administrator wants to provide an option model to Jobs that\nneed to know what packages provide a given capability.")]),e._v(" "),t("p",[e._v("The code listing below shows it is a simple wrapper around the\nrepoquery command that formats the results as "),t("a",{attrs:{href:"http://www.json.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("JSON"),t("OutboundLink")],1),e._v(" data.")]),e._v(" "),t("p",[e._v("File listing: repoquery.cgi")]),e._v(" "),t("div",{staticClass:"language-{.bash .numberLines} extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('#!/bin/bash\n# Requires: repoquery\n#\n# Query Params and their defaults\nrepo=acme-staging\nlabel="Anvils Release"\npackage=anvils\nmax=30\n#\necho Content-type: application/json\necho ""\nfor VAR in `echo $QUERY_STRING | tr "&" "\\t"`\ndo\n  NAME=$(echo $VAR | tr = " " | awk \'{print $1}\';);\n  VALUE=$(echo $VAR | tr = " " | awk \'{ print $2}\' | tr + " ");\n  declare $NAME="$VALUE";\ndone\n\necho \'{\'\nrepoquery --enablerepo=$repo --show-dupes \\\n  --qf=\'"${label} %{VERSION}-%{RELEASE}":"%{NAME}-%{VERSION}-%{RELEASE}",\' \\\n  -q --whatprovides ${package} | sort -t - -k 4,4nr | head -n${max}\necho \'}\'\n')])])]),t("p",[e._v("After deploying this script to the CGI enabled directory on the\noperations web server, it can be tested directly by requesting it using "),t("a",{attrs:{href:"http://linux.die.net/man/1/curl",target:"_blank",rel:"noopener noreferrer"}},[e._v("curl"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("div",{staticClass:"language-{.bash} extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('curl -d "repo=acme&label=Anvils&package=anvils" \\\n    --get http://yum.acme.com/cgi-bin/repoquery.cgi\n')])])]),t("p",[e._v("The server response should return JSON data resembling the example below:")]),e._v(" "),t("div",{staticClass:"language-{.json} extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('[\n  {"name":"anvils-1.1.rpm", "value":"/dist/RPMS/noarch/anvils-1.1.rpm"},\n  {"name":"anvils-1.2.rpm", "value":"/dist/RPMS/noarch/anvils-1.2.rpm"}\n]\n')])])]),t("p",[e._v("Jobs can request the option model data like so:")]),e._v(" "),t("div",{staticClass:"language-{.xml} extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('<option name="package" enforcedvalues="true" required="true"\n    valuesUrl="http://yum.acme.com/cgi-bin/repoquery.cgi?package=anvils"/>\n')])])]),t("p",[e._v("The Rundeck UI will display the package names in the menu and once\nselected, the Job will have the matching package versions.")])])},[],!1,null,null,null);a.default=n.exports}}]);