(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{508:function(e,t,r){"use strict";r.r(t);var a=r(0),o=Object(a.a)({},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"using-mysql-as-a-database-backend"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#using-mysql-as-a-database-backend","aria-hidden":"true"}},[e._v("#")]),e._v(" Using MySQL as a database backend")]),e._v(" "),r("div",{staticClass:"warning custom-block"},[r("p",[e._v("MySQL 5.7 or greater is recommended\nThis is a simple guide for setting up Mysql for use with Rundeck.")])]),e._v(" "),r("h2",{attrs:{id:"install-mysql"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#install-mysql","aria-hidden":"true"}},[e._v("#")]),e._v(" Install MySQL")]),e._v(" "),r("p",[e._v('You can "yum install" or "apt-get install" the server, you can find installation guides for other OS '),r("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/installing.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),r("OutboundLink")],1)]),e._v(" "),r("h2",{attrs:{id:"configure-mysql"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#configure-mysql","aria-hidden":"true"}},[e._v("#")]),e._v(" Configure MySQL")]),e._v(" "),r("p",[e._v("After install, run the "),r("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/mysql-secure-installation.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("mysql_secure_installation script"),r("OutboundLink")],1),e._v(". This will let prompt you to set the root password for mysql, as well as disable anonymous access.")]),e._v(" "),r("p",[e._v("Set an appropriate "),r("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/innodb-buffer-pool-resize.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("innodb_buffer_pool_size"),r("OutboundLink")],1),e._v(". MySQL, like many databases, manages\nits own page cache and the buffer pool size determines how much RAM it can use! Setting this to 80% of the system memory is the common wisdom for dedicated\nservers, however you may want go higher if your server has more than 32G of RAM.")]),e._v(" "),r("h3",{attrs:{id:"mysql-5-6"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#mysql-5-6","aria-hidden":"true"}},[e._v("#")]),e._v(" MySQL 5.6")]),e._v(" "),r("p",[r("code",[e._v("5.6.3")]),e._v(" or greater is required if using "),r("code",[e._v("utf8mb4")]),e._v(" character set as the server default, and upgrading or installation may require an extra step.")]),e._v(" "),r("p",[e._v("Configuration:")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("innodb_file_format=barracuda\ninnodb_file_per_table=true\ninnodb_large_prefix=true\n")])])]),r("p",[e._v("After first Rundeck start run the following SQL queries:")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("use <rundeck_database>;\nALTER TABLE `event_subscription` ROW_FORMAT=dynamic;\nALTER TABLE `reaction` ROW_FORMAT=dynamic;\nALTER TABLE `reaction_event` ROW_FORMAT=dynamic;\n")])])]),r("p",[e._v("Restart Rundeck!")]),e._v(" "),r("h2",{attrs:{id:"setup-rundeck-database"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#setup-rundeck-database","aria-hidden":"true"}},[e._v("#")]),e._v(" Setup Rundeck Database")]),e._v(" "),r("p",[e._v("Now you want to create a database and user access for the Rundeck server.")]),e._v(" "),r("p",[e._v('If it is not running, start mysqld with "service mysqld start"')]),e._v(" "),r("p",[e._v("Use the 'mysql' commandline tool to access the db as the root user:")]),e._v(" "),r("pre",[r("code",[e._v("$ mysql -u root -p\n")])]),e._v(" "),r("p",[e._v("Enter your root password to connect. Once you have the mysql> prompt, enter the following commands to create the rundeck database:")]),e._v(" "),r("pre",[r("code",[e._v("mysql> create database rundeck;\nQuery OK, 1 row affected (0.00 sec)\n")])]),e._v(" "),r("p",[e._v('Then "grant" access for a new user/password, and specify the hostname the Rundeck server will connect from. if it is the same server, you can use "localhost".')]),e._v(" "),r("pre",[r("code",[e._v("mysql> grant ALL on rundeck.* to 'rundeckuser'@'localhost' identified by 'rundeckpassword';\nQuery OK, 1 row affected (0.00 sec)\n")])]),e._v(" "),r("p",[e._v("You can then exit the mysql prompt.")]),e._v(" "),r("p",[e._v("Test access (if it's from localhost) by running:")]),e._v(" "),r("pre",[r("code",[e._v("$ mysql -u rundeckuser -p\n")])]),e._v(" "),r("p",[e._v('You can verify you can see the "rundeck" database with:')]),e._v(" "),r("pre",[r("code",[e._v("mysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| rundeck            |\n+--------------------+\n2 rows in set (0.00 sec)\n")])]),e._v(" "),r("h2",{attrs:{id:"configure-rundeck"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#configure-rundeck","aria-hidden":"true"}},[e._v("#")]),e._v(" Configure Rundeck")]),e._v(" "),r("p",[e._v("Now you need to configure Rundeck to connect to this DB.")]),e._v(" "),r("p",[e._v("Update your "),r("code",[e._v("rundeck-config.properties")]),e._v(" and configure the datasource:")]),e._v(" "),r("ul",[r("li",[e._v("RPM/Debian location: "),r("code",[e._v("/etc/rundeck/rundeck-config.properties")])]),e._v(" "),r("li",[e._v("Launcher location: "),r("code",[e._v("$RDECK_BASE/server/config/rundeck-config.properties")])])]),e._v(" "),r("p",[e._v("Contents:")]),e._v(" "),r("pre",[r("code",[e._v("dataSource.url = jdbc:mysql://myserver/rundeck?autoReconnect=true&useSSL=false\ndataSource.username=rundeckuser\ndataSource.password=rundeckpassword\ndataSource.driverClassName=com.mysql.jdbc.Driver\n")])]),e._v(" "),r("p",[e._v("Finally you can start rundeck. If you see a startup error about database access, make sure that the hostname that the Mysql server sees from the client is the same one you granted access to.")]),e._v(" "),r("p",[e._v("NB: "),r("code",[e._v("autoReconnect=true")]),e._v(' will fix a common problem where the Rundeck server\'s connection to Mysql is dropped after a period of inactivity, resulting in an error message: "Message: Can not read response from server. Expected to read 4 bytes, read 0 bytes before connection was unexpectedly lost."')]),e._v(" "),r("p",[e._v("See more about "),r("a",{attrs:{href:"https://dev.mysql.com/doc/connector-j/5.1/en/connector-j-reference-configuration-properties.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("configuring the Mysql JDBC Connector/J URL"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("h1",{attrs:{id:"mysql-migration-guide"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#mysql-migration-guide","aria-hidden":"true"}},[e._v("#")]),e._v(" Mysql migration guide")]),e._v(" "),r("p",[e._v("This section describes how to migrate a set of Rundeck projects from\nthe built-in H2 database, to use Mysql.")]),e._v(" "),r("h2",{attrs:{id:"project-export-all-projects"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#project-export-all-projects","aria-hidden":"true"}},[e._v("#")]),e._v(" Project export all projects")]),e._v(" "),r("p",[e._v("For each project you want to retain, Export the archive via the GUI:")]),e._v(" "),r("ul",[r("li",[e._v("Navigate to Configure page for the project\n"),r("ul",[r("li",[e._v("Either click the cog icon in the header, then choose your project from the list")]),e._v(" "),r("li",[e._v("OR click the Configure button next to the project name in the home page")])])]),e._v(" "),r("li",[e._v('Click on the "Export Archive" tab')]),e._v(" "),r("li",[e._v('Click "Export project.rdproject.jar"')]),e._v(" "),r("li",[e._v("Wait for export process to complete")]),e._v(" "),r("li",[e._v("Click the link to download the file")])]),e._v(" "),r("p",[e._v("Note: make sure to click the final link that is presented to download the file.")]),e._v(" "),r("p",[e._v('Save each project archive file (named "[project name]-XXXX.rdproject.jar")\nin a place you can upload it later.')]),e._v(" "),r("h2",{attrs:{id:"backup-your-rundeck-data"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#backup-your-rundeck-data","aria-hidden":"true"}},[e._v("#")]),e._v(" Backup your Rundeck data")]),e._v(" "),r("ul",[r("li",[e._v("Make a backup of your Projects\n"),r("ul",[r("li",[e._v("RPM/Debian install location: "),r("code",[e._v("/var/rundeck/projects")])]),e._v(" "),r("li",[e._v("Launcher location: "),r("code",[e._v("$RDECK_BASE/prjoects")])])])]),e._v(" "),r("li",[e._v("Make a backup of your H2 database, which you can revert back to in case of error,\n"),r("ul",[r("li",[e._v("RPM/Debian install location: "),r("code",[e._v("/var/lib/rundeck/data")])]),e._v(" "),r("li",[e._v("Launcher location: "),r("code",[e._v("$RDECK_BASE/server/data")])])])])]),e._v(" "),r("h2",{attrs:{id:"stop-rundeck"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#stop-rundeck","aria-hidden":"true"}},[e._v("#")]),e._v(" Stop rundeck")]),e._v(" "),r("p",[e._v("Unix:")]),e._v(" "),r("pre",[r("code",[e._v("sudo service rundeckd stop\n")])]),e._v(" "),r("h2",{attrs:{id:"setup-mysql"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#setup-mysql","aria-hidden":"true"}},[e._v("#")]),e._v(" Setup mysql")]),e._v(" "),r("p",[e._v("Install Mysql according to the instructions for your platform.")]),e._v(" "),r("h2",{attrs:{id:"prepare-mysql-database"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#prepare-mysql-database","aria-hidden":"true"}},[e._v("#")]),e._v(" Prepare Mysql database")]),e._v(" "),r("p",[e._v("Perform this command to log in as root:")]),e._v(" "),r("pre",[r("code",[e._v("mysql -u root -p\n")])]),e._v(" "),r("p",[e._v("Then execute this sql:")]),e._v(" "),r("pre",[r("code",[e._v("> create database rundeck\n> grant ALL on rundeck.* to 'rundeckuser'@'localhost' identified by 'rundeckpassword'\n")])]),e._v(" "),r("h2",{attrs:{id:"configure-rundeck-config-properties"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#configure-rundeck-config-properties","aria-hidden":"true"}},[e._v("#")]),e._v(" Configure rundeck-config.properties")]),e._v(" "),r("p",[e._v("Set the datasource URL to point to your Mysql host, with appropriate database name,\nusername and password.")]),e._v(" "),r("p",[e._v("See "),r("a",{attrs:{href:"#configure-rundeck"}},[e._v("Configure Rundeck")]),e._v(" above.")]),e._v(" "),r("h2",{attrs:{id:"configure-project-config-in-db"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#configure-project-config-in-db","aria-hidden":"true"}},[e._v("#")]),e._v(" Configure project config in DB")]),e._v(" "),r("p",[e._v("Enable DB storage for Project configurations, and Key Storage. Optionally enable encryption.")]),e._v(" "),r("p",[e._v("For more info refer to:")]),e._v(" "),r("ul",[r("li",[e._v("(/administration/security/key-storage.md)")]),e._v(" "),r("li",[e._v("(/administration/configuration/plugins/bundled-plugins.md#jasypt-encryption-plugin)")]),e._v(" "),r("li",[e._v("(/administration/configuration/storage-facility.md)")])]),e._v(" "),r("h2",{attrs:{id:"start-up-rundeck"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#start-up-rundeck","aria-hidden":"true"}},[e._v("#")]),e._v(" Start up Rundeck")]),e._v(" "),r("p",[e._v("Start the Rundeck server again.")]),e._v(" "),r("p",[e._v("Unix:")]),e._v(" "),r("pre",[r("code",[e._v("sudo service rundeckd start\n")])]),e._v(" "),r("p",[e._v('View the "/var/log/rundeck/service.log" file for any error messages.')]),e._v(" "),r("ul",[r("li",[e._v("Project definitions/configs will be imported to DB automatically")]),e._v(" "),r("li",[e._v("Resources.xml remain in the same location")])]),e._v(" "),r("h2",{attrs:{id:"import-archives"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#import-archives","aria-hidden":"true"}},[e._v("#")]),e._v(" Import archives")]),e._v(" "),r("p",[e._v("For each project you wish to import, go to the Configure page for the project:")]),e._v(" "),r("ul",[r("li",[e._v('Click the "Import Archive" tab')]),e._v(" "),r("li",[e._v("Upload the project archive with the corresponding name")]),e._v(" "),r("li",[e._v("Optionally choose to Import All Executions")]),e._v(" "),r("li",[e._v("Click Import")])])])},[],!1,null,null,null);t.default=o.exports}}]);