(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{190:function(e,t,o){"use strict";o.r(t);var s=o(0),a=Object(s.a)({},function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"ssh-node-execution"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#ssh-node-execution","aria-hidden":"true"}},[e._v("#")]),e._v(" SSH Node Execution")]),e._v(" "),o("p",[e._v("Rundeck by default uses SSH to execute commands on remote nodes, SCP to copy scripts to remote nodes, and locally executes commands and scripts for the local (server) node.")]),e._v(" "),o("p",[e._v("The SSH plugin expects each node definition to have the following properties in order to create the SSH connection:")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("hostname")]),e._v(': the hostname of the remote node. It can be in the format "hostname:port" to indicate that a non-default port should be used. The default port is 22.')]),e._v(" "),o("li",[o("code",[e._v("username")]),e._v(": the username to connect to the remote node.")])]),e._v(" "),o("p",[e._v("In addition, for both SSH and SCP, you must either configure a public/private keypair for the remote node or configure the node for SSH Password authentication.")]),e._v(" "),o("p",[e._v("Out of the box typical node configuration to make use of these is simple.")]),e._v(" "),o("ul",[o("li",[e._v("Set the "),o("code",[e._v("hostname")]),e._v(' attribute for the nodes. It can be in the format "hostname:port" to indicate that a non-default port should be used. The default port is 22.')]),e._v(" "),o("li",[e._v("Set the "),o("code",[e._v("username")]),e._v(" attribute for the nodes to the username to connect to the remote node.")]),e._v(" "),o("li",[e._v("set up public/private key authentication from the Rundeck server to the nodes")])]),e._v(" "),o("p",[e._v("This will allow remote command and script execution on the nodes.")]),e._v(" "),o("p",[e._v("See below for more configuration options.")]),e._v(" "),o("p",[o("strong",[e._v("Sudo Password Authentication")])]),e._v(" "),o("p",[e._v('The SSH plugin also includes support for a secondary Sudo Password Authentication. This simulates a user writing a password to the terminal into a password prompt when invoking a "sudo" command that requires password authentication.')]),e._v(" "),o("h3",{attrs:{id:"using-key-storage-for-ssh"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#using-key-storage-for-ssh","aria-hidden":"true"}},[e._v("#")]),e._v(" Using Key Storage for SSH")]),e._v(" "),o("p",[e._v("Passwords, Passphrases and Private Keys can all be stored in the "),o("router-link",{attrs:{to:"/administration/administration/security/key-storage.html"}},[e._v("Key Storage Facility")]),e._v(" and used with the built-in SSH plugins for Node Execution and File Copying.")],1),e._v(" "),o("p",[e._v("For specific usage, see below.")]),e._v(" "),o("p",[e._v("The storage facility can be configured to store the keys on disk, or in the database, and can use plugins to provide encryption of the data.")]),e._v(" "),o("p",[e._v("When uploaded, private keys and passwords are identified by a "),o("em",[e._v("path")]),e._v(" which locates them in the storage facility. The "),o("em",[e._v("path")]),e._v(" looks similar to a unix filesystem path.")]),e._v(" "),o("p",[e._v("All SSH Keys and Passwords are stored under the "),o("code",[e._v("keys/")]),e._v(" top-level path.")]),e._v(" "),o("p",[o("strong",[e._v("Note:")]),e._v(' In general if a "key storage path" and another configuration option are both specified, the "key storage path" will be used.')]),e._v(" "),o("p",[e._v("You can embed context property references within the key storage path such as "),o("code",[e._v("${job.project}")]),e._v(". See (/manual/job-workflows.md#context-variables]].")]),e._v(" "),o("h3",{attrs:{id:"scp-file-copier"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#scp-file-copier","aria-hidden":"true"}},[e._v("#")]),e._v(" SCP File Copier")]),e._v(" "),o("p",[e._v("In addition to the general SSH configuration mentioned for in this section, some additional configuration can be done for SCP.")]),e._v(" "),o("p",[e._v("When a Script is executed on a remote node, it is copied over via SCP first, and then executed. In addition to the SSH connection properties, some attributes\ncan be configured. See [File Copier destination directory](/administration/projects/node-execution/builtin.md#file-copier-destination-directory].")]),e._v(" "),o("h3",{attrs:{id:"authentication-types"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#authentication-types","aria-hidden":"true"}},[e._v("#")]),e._v(" Authentication types")]),e._v(" "),o("p",[e._v("SSH authentication can be done in two ways, via password or public/private key.")]),e._v(" "),o("p",[e._v("By default, public/private key is used, but this can be changed on a node, project, or framework scope.")]),e._v(" "),o("p",[e._v("The mechanism used is determined by the "),o("code",[e._v("ssh-authentication")]),e._v(" property. This property can have two different values:")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("password")])]),e._v(" "),o("li",[o("code",[e._v("privateKey")]),e._v(" (default)")])]),e._v(" "),o("p",[e._v("When connecting to a particular Node, this sequence is used to determine the correct authentication mechanism:")]),e._v(" "),o("ol",[o("li",[o("strong",[e._v("Node level")]),e._v(": "),o("code",[e._v("ssh-authentication")]),e._v(" attribute on the Node. Applies only to the target node.")]),e._v(" "),o("li",[o("strong",[e._v("Project level")]),e._v(": "),o("code",[e._v("project.ssh-authentication")]),e._v(" property in "),o("code",[e._v("project.properties")]),e._v(". Applies to any project node by default.")]),e._v(" "),o("li",[o("strong",[e._v("Rundeck level")]),e._v(": "),o("code",[e._v("framework.ssh-authentication")]),e._v(" property in "),o("code",[e._v("framework.properties")]),e._v(". Applies to all projects by default.")])]),e._v(" "),o("p",[e._v("If none of those values are set, then the default public/private key authentication is used.")]),e._v(" "),o("h3",{attrs:{id:"specifying-ssh-username"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#specifying-ssh-username","aria-hidden":"true"}},[e._v("#")]),e._v(" Specifying SSH Username")]),e._v(" "),o("p",[e._v("The username used to connect via SSH is taken from the "),o("code",[e._v("username")]),e._v(" Node attribute:")]),e._v(" "),o("ul",[o("li",[o("code",[e._v('username="user1"')])])]),e._v(" "),o("p",[e._v("This value can also include a property reference if you want to dynamically change it, for example to the name of the current Rundeck user, or the username submitted as a Job Option value:")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("${job.username}")]),e._v(" - uses the username of the user executing the Rundeck execution.")]),e._v(" "),o("li",[o("code",[e._v("${option.someUsername}")]),e._v(' - uses the value of a job option named "someUsername".')])]),e._v(" "),o("p",[e._v("If the "),o("code",[e._v("username")]),e._v(" node attribute is not set, then the static value provided via project or framework configuration is used. The username for a node is determined by looking for a value in this order:")]),e._v(" "),o("ol",[o("li",[o("strong",[e._v("Node level")]),e._v(": "),o("code",[e._v("username")]),e._v(" node attribute. Can contain property references to dynamically set it from Option or Execution values.")]),e._v(" "),o("li",[o("strong",[e._v("Project level")]),e._v(": "),o("code",[e._v("project.ssh.user")]),e._v(" property in "),o("code",[e._v("project.properties")]),e._v(" file for the project.")]),e._v(" "),o("li",[o("strong",[e._v("Rundeck level")]),e._v(": "),o("code",[e._v("framework.ssh.user")]),e._v(" property in "),o("code",[e._v("framework.properties")]),e._v(" file for the Rundeck installation.")])]),e._v(" "),o("h3",{attrs:{id:"specifying-ssh-config-options"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#specifying-ssh-config-options","aria-hidden":"true"}},[e._v("#")]),e._v(" Specifying SSH Config options")]),e._v(" "),o("p",[e._v("Default config options:")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("PreferredAuthentications: publickey,password,keyboard-interactive")])]),e._v(" "),o("li",[o("code",[e._v("MaxAuthTries: 1")])])]),e._v(" "),o("p",[e._v("SSH config options can be specified by setting the following properties:")]),e._v(" "),o("ol",[o("li",[o("strong",[e._v("Node level")]),e._v(": "),o("code",[e._v("ssh-config-KEY")]),e._v(" attribute on the Node. Applies only to the target node.")]),e._v(" "),o("li",[o("strong",[e._v("Project level")]),e._v(": "),o("code",[e._v("project.ssh-config-KEY")]),e._v(" property in "),o("code",[e._v("project.properties")]),e._v(". Applies to any project node by default.")]),e._v(" "),o("li",[o("strong",[e._v("Rundeck level")]),e._v(": "),o("code",[e._v("framework.ssh-config-KEY")]),e._v(" property in "),o("code",[e._v("framework.properties")]),e._v(". Applies to all projects by default.")])]),e._v(" "),o("h3",{attrs:{id:"specifying-ssh-timeout-options"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#specifying-ssh-timeout-options","aria-hidden":"true"}},[e._v("#")]),e._v(" Specifying SSH Timeout options")]),e._v(" "),o("p",[e._v("SSH timeout options can be specified. The timeout values are in milliseconds.\nA value of 0 means the timeout will be indefinite.\nThe precedence level is Node > Project > Rundeck.")]),e._v(" "),o("ol",[o("li",[o("p",[o("strong",[e._v("Node level")]),e._v(": attribute on the Node. Applies only to the target node.")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("ssh-connection-timeout")]),e._v(" connection timeout")]),e._v(" "),o("li",[o("code",[e._v("ssh-command-timeout")]),e._v(" command timeout")])])]),e._v(" "),o("li",[o("p",[o("strong",[e._v("Project level")]),e._v(": Applies to any project node by default. Set property in Project Config ("),o("code",[e._v("project.properties")]),e._v(").")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("project.ssh-connection-timeout")]),e._v(" connection timeout")]),e._v(" "),o("li",[o("code",[e._v("project.ssh-command-timeout")]),e._v(" command timeout")])])]),e._v(" "),o("li",[o("p",[o("strong",[e._v("Rundeck level")]),e._v(": Applies to all projects by default. Set property in "),o("code",[e._v("framework.properties")]),e._v(".")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("framework.ssh-connection-timeout")]),e._v(" connection timeout")]),e._v(" "),o("li",[o("code",[e._v("framework.ssh-command-timeout")]),e._v(" command timeout")])])])]),e._v(" "),o("p",[e._v("Deprecated: The framework property "),o("code",[e._v("framework.ssh.timeout")]),e._v(" will also be used for Connection timeout if set.")]),e._v(" "),o("h3",{attrs:{id:"ssh-private-keys"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#ssh-private-keys","aria-hidden":"true"}},[e._v("#")]),e._v(" SSH Private Keys")]),e._v(" "),o("p",[e._v("Choose either:")]),e._v(" "),o("ul",[o("li",[o("a",{attrs:{href:"#ssh-private-keys-on-disk"}},[e._v("SSH Private Keys On Disk")])]),e._v(" "),o("li",[o("a",{attrs:{href:"#ssh-private-key-storage"}},[e._v("SSH Private Key Storage")])])]),e._v(" "),o("p",[e._v("If the Private Key is encrypted with a passphrase, see: "),o("a",{attrs:{href:"#ssh-private-key-passphrase"}},[e._v("SSH Private Key Passphrase")]),e._v(".")]),e._v(" "),o("h4",{attrs:{id:"ssh-private-keys-on-disk"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#ssh-private-keys-on-disk","aria-hidden":"true"}},[e._v("#")]),e._v(" SSH Private Keys On Disk")]),e._v(" "),o("p",[e._v("The default authentication mechanism is public/private key using a "),o("strong",[e._v("private key file")]),e._v(" stored locally on disk.")]),e._v(" "),o("p",[e._v("The built-in SSH connector allows the private key file to be specified in several different ways. You can configure it per-node, per-project, or per-Rundeck instance.")]),e._v(" "),o("p",[e._v("When connecting to the remote node, Rundeck will look for a property/attribute specifying the location of the "),o("strong",[e._v("private key file")]),e._v(", in this order, with the first match having precedence:")]),e._v(" "),o("ol",[o("li",[o("strong",[e._v("Node level")]),e._v(": "),o("code",[e._v("ssh-keypath")]),e._v(" attribute on the Node. Applies only to the target node.")]),e._v(" "),o("li",[o("strong",[e._v("Project level")]),e._v(": "),o("code",[e._v("project.ssh-keypath")]),e._v(" property in "),o("code",[e._v("project.properties")]),e._v(". Applies to any project node by default.")]),e._v(" "),o("li",[o("strong",[e._v("Rundeck level")]),e._v(": "),o("code",[e._v("framework.ssh-keypath")]),e._v(" property in "),o("code",[e._v("framework.properties")]),e._v(". Applies to all projects by default.")])]),e._v(" "),o("p",[e._v('If you private key is encrypted with a passphrase, then you can use a "Secure Remote Authentication Option" to prompt the user to enter the passphrase when executing on the Node. See below.')]),e._v(" "),o("p",[e._v("You can embed context property references within the keypath such as "),o("code",[e._v("${job.project}")]),e._v(". See (/manual/job-workflows.md#context-variables]].")]),e._v(" "),o("h4",{attrs:{id:"ssh-private-key-storage"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#ssh-private-key-storage","aria-hidden":"true"}},[e._v("#")]),e._v(" SSH Private Key Storage")]),e._v(" "),o("p",[o("strong",[e._v("Note:")]),e._v(" See "),o("a",{attrs:{href:"#using-key-storage-for-ssh"}},[e._v("Using Key Storage for SSH")]),e._v(".")]),e._v(" "),o("p",[e._v("When connecting to the remote node, Rundeck will look for a property/attribute specifying the location of the "),o("strong",[e._v("private key storage path")]),e._v(", in this order, with the first match having precedence:")]),e._v(" "),o("ol",[o("li",[o("strong",[e._v("Node level")]),e._v(": "),o("code",[e._v("ssh-key-storage-path")]),e._v(" attribute on the Node. Applies only to the target node.")]),e._v(" "),o("li",[o("strong",[e._v("Project level")]),e._v(": "),o("code",[e._v("project.ssh-key-storage-path")]),e._v(" property in "),o("code",[e._v("project.properties")]),e._v(". Applies to any project node by default.")]),e._v(" "),o("li",[o("strong",[e._v("Rundeck level")]),e._v(": "),o("code",[e._v("framework.ssh-key-storage-path")]),e._v(" property in "),o("code",[e._v("framework.properties")]),e._v(". Applies to all projects by default.")])]),e._v(" "),o("p",[e._v("If you private key is encrypted with a passphrase, see "),o("a",{attrs:{href:"#ssh-private-key-passphrase"}},[e._v("SSH Private Key Passphrase")]),e._v(" below.")]),e._v(" "),o("h3",{attrs:{id:"ssh-private-key-passphrase"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#ssh-private-key-passphrase","aria-hidden":"true"}},[e._v("#")]),e._v(" SSH Private Key Passphrase")]),e._v(" "),o("p",[e._v("To enable SSH Private Key authentication, first make sure the "),o("code",[e._v("ssh-authentication")]),e._v(" value is set ("),o("a",{attrs:{href:"#authentication-types"}},[e._v("#authentication-types")]),e._v(". Second, configure the path to the private key file ("),o("a",{attrs:{href:"#ssh-private-keys"}},[e._v("#ssh-private-keys")]),e._v(").")]),e._v(" "),o("p",[e._v("Choose a method to provide a passphrase:")]),e._v(" "),o("ul",[o("li",[o("a",{attrs:{href:"#ssh-private-key-passphrase-with-a-job-option"}},[e._v("SSH Private Key Passphrase with a Job Option")])]),e._v(" "),o("li",[o("a",{attrs:{href:"#ssh-private-key-passphrase-storage"}},[e._v("SSH Private Key Passphrase Storage")])])]),e._v(" "),o("h4",{attrs:{id:"ssh-private-key-passphrase-with-a-job-option"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#ssh-private-key-passphrase-with-a-job-option","aria-hidden":"true"}},[e._v("#")]),e._v(" SSH Private Key Passphrase with a Job Option")]),e._v(" "),o("p",[e._v("You can use a Job Option for a passphrase for privateKey authentication. When the user executes the Job, they are prompted for the key's passphrase. The Secure Remote Authentication Option value for the passphrase is not stored in the database, and is used only for that execution.")]),e._v(" "),o("p",[e._v("Passphrases are input either via the GUI or arguments to the job if executed via CLI or API.")]),e._v(" "),o("p",[e._v("First, configure a Job, and include an Option definition where "),o("code",[e._v("secureInput")]),e._v(" is set to "),o("code",[e._v("true")]),e._v(".\nThe name of this option can be anything you want,\nbut the default value of "),o("code",[e._v("sshKeyPassphrase")]),e._v(" assumed by the node configuration is easiest.")]),e._v(" "),o("p",[e._v("If the value is not "),o("code",[e._v("sshKeyPassphrase")]),e._v(", then make sure to set the following attribute on each Node for password authentication:")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("ssh-key-passphrase-option")]),e._v(' = "'),o("code",[e._v("option.NAME")]),e._v("\" where NAME is the name of the Job's Secure Remote Authentication Option.")])]),e._v(" "),o("p",[e._v("An example Node and Job option configuration are below:")]),e._v(" "),o("div",{staticClass:"language-{.xml .numberLines} extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v('<node name="egon" description="egon" osFamily="unix"\n    username="rundeck"\n    hostname="egon"\n    ssh-keypath="/path/to/privatekey_rsa"\n    ssh-authentication="privateKey"\n    ssh-key-passphrase-option="option.sshKeyPassphrase" />\n')])])]),o("p",[e._v("Job:")]),e._v(" "),o("div",{staticClass:"language-{.xml .numberLines} extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("<joblist>\n    <job>\n        \x3c!-- ... --\x3e\n        <context>\n          <project>project</project>\n          <options>\n            <option required='true' name='sshKeyPassphrase' secure='true'\n              description=\"Passphrase for SSH Private Key\"/>\n          </options>\n        </context>\n        \x3c!-- ... --\x3e\n    </job>\n</joblist>\n")])])]),o("h4",{attrs:{id:"ssh-private-key-passphrase-storage"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#ssh-private-key-passphrase-storage","aria-hidden":"true"}},[e._v("#")]),e._v(" SSH Private Key Passphrase Storage")]),e._v(" "),o("p",[o("strong",[e._v("Note:")]),e._v(" See "),o("a",{attrs:{href:"#using-key-storage-for-ssh"}},[e._v("Using Key Storage for SSH")]),e._v(".")]),e._v(" "),o("p",[e._v("When connecting to the remote node with a private key,\nRundeck will look for a property/attribute\nspecifying the location of the "),o("strong",[e._v("private key passphrase storage path")]),e._v(",\nin this order, with the first match having precedence:")]),e._v(" "),o("ol",[o("li",[o("strong",[e._v("Node level")]),e._v(": "),o("code",[e._v("ssh-key-passphrase-storage-path")]),e._v(" attribute on the Node. Applies only to the target node.")]),e._v(" "),o("li",[o("strong",[e._v("Project level")]),e._v(": "),o("code",[e._v("project.ssh-key-passphrase-storage-path")]),e._v(" property in "),o("code",[e._v("project.properties")]),e._v(". Applies to any project node by default.")]),e._v(" "),o("li",[o("strong",[e._v("Rundeck level")]),e._v(": "),o("code",[e._v("framework.ssh-key-passphrase-storage-path")]),e._v(" property in "),o("code",[e._v("framework.properties")]),e._v(". Applies to all projects by default.")])]),e._v(" "),o("p",[e._v("An example Node using private key passphrase storage:")]),e._v(" "),o("div",{staticClass:"language-{.xml .numberLines} extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v('<node name="egon" description="egon" osFamily="unix"\n    username="rundeck"\n    hostname="egon"\n    ssh-authentication="privateKey"\n    ssh-key-storage-path="keys/nodes/${node.name}.key"\n    ssh-key-passphrase-storage-path="keys/nodes/${node.name}.key.password" />\n')])])]),o("h3",{attrs:{id:"ssh-password-authentication"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#ssh-password-authentication","aria-hidden":"true"}},[e._v("#")]),e._v(" SSH Password Authentication")]),e._v(" "),o("p",[e._v("Password authentication works in one of two ways:")]),e._v(" "),o("ul",[o("li",[o("a",{attrs:{href:"#ssh-password-with-a-job-option"}},[e._v("SSH Password with a Job Option")])]),e._v(" "),o("li",[o("a",{attrs:{href:"#ssh-password-storage"}},[e._v("SSH Password Storage")]),e._v(".")])]),e._v(" "),o("p",[e._v("In both cases, to enable SSH Password authentication, first make sure the "),o("code",[e._v("ssh-authentication")]),e._v(" value is set as described in "),o("a",{attrs:{href:"#authentication-types"}},[e._v("Authentication types")]),e._v(".")]),e._v(" "),o("p",[e._v("Both methods can be used for multiple nodes within a Job. I.e. some nodes could be authenticated via stored password, and others via Job option user input.")]),e._v(" "),o("h4",{attrs:{id:"ssh-password-with-a-job-option"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#ssh-password-with-a-job-option","aria-hidden":"true"}},[e._v("#")]),e._v(" SSH Password with a Job Option")]),e._v(" "),o("p",[e._v("Passwords for the nodes are input either via the GUI or arguments to the job if executed via CLI or API.")]),e._v(" "),o("ol",[o("li",[e._v("The Job must define a Secure Remote Authentication Option to prompt the user for the password before execution.")]),e._v(" "),o("li",[e._v("All Nodes using this method must have an equivalent Secure Remote Authentication Option defined, or may use the same option name (or the default) if they share authentication passwords.")])]),e._v(" "),o("p",[e._v("First configure a Job and include one or more Option definitions where Secure Remote Authentication type is selected. (In XML/YAML, "),o("code",[e._v("secure")]),e._v(" is set to "),o("code",[e._v("true")]),e._v(", and "),o("code",[e._v("valueExposed")]),e._v(" is set to "),o("code",[e._v("false")]),e._v(".) The name of this option can be anything you want, but the default value of "),o("code",[e._v("sshPassword")]),e._v(" assumed by the node configuration is easiest. If you need multiple different passwords for different nodes, you must define multiple options in this way.")]),e._v(" "),o("p",[e._v("If the option name is not "),o("code",[e._v("sshPassword")]),e._v(", then make sure to set the following attribute on each Node for password authentication:")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("ssh-password-option")]),e._v(' = "'),o("code",[e._v("option.NAME")]),e._v("\" where NAME is the name of the Job's Secure Remote Authentication Option.")])]),e._v(" "),o("p",[e._v("An example Node and Job option configuration are below:")]),e._v(" "),o("div",{staticClass:"language-{.xml .numberLines} extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v('<node name="egon" description="egon" osFamily="unix"\n    username="rundeck"\n    hostname="egon"\n    ssh-authentication="password"\n    ssh-password-option="option.sshPassword1" />\n')])])]),o("p",[e._v("Job:")]),e._v(" "),o("div",{staticClass:"language-{.xml .numberLines} extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("<joblist>\n    <job>\n        \x3c!-- ... --\x3e\n        <context>\n          <project>project</project>\n          <options>\n            <option required='true' name='sshPassword1' secure='true' valueExposed=\"false\"/>\n          </options>\n        </context>\n        \x3c!-- ... --\x3e\n    </job>\n</joblist>\n")])])]),o("h4",{attrs:{id:"ssh-password-storage"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#ssh-password-storage","aria-hidden":"true"}},[e._v("#")]),e._v(" SSH Password Storage")]),e._v(" "),o("p",[o("strong",[e._v("Note:")]),e._v(" See "),o("a",{attrs:{href:"#using-key-storage-for-ssh"}},[e._v("Using Key Storage for SSH")]),e._v(".")]),e._v(" "),o("p",[e._v("When connecting to the remote node, Rundeck will look for a property/attribute specifying the location of the "),o("strong",[e._v("password storage path")]),e._v(", in this order, with the first match having precedence:")]),e._v(" "),o("ol",[o("li",[o("strong",[e._v("Node level")]),e._v(": "),o("code",[e._v("ssh-password-storage-path")]),e._v(" attribute on the Node. Applies only to the target node.")]),e._v(" "),o("li",[o("strong",[e._v("Project level")]),e._v(": "),o("code",[e._v("project.ssh-password-storage-path")]),e._v(" property in "),o("code",[e._v("project.properties")]),e._v(". Applies to any project node by default.")]),e._v(" "),o("li",[o("strong",[e._v("Rundeck level")]),e._v(": "),o("code",[e._v("framework.ssh-password-storage-path")]),e._v(" property in "),o("code",[e._v("framework.properties")]),e._v(". Applies to all projects by default.")])]),e._v(" "),o("p",[o("strong",[e._v("Note:")]),e._v(" If both "),o("code",[e._v("ssh-password-storage-path")]),e._v(" and "),o("code",[e._v("ssh-password-option")]),e._v(" resolve to a value, then the "),o("code",[e._v("ssh-password-storage-path")]),e._v(" will be used.")]),e._v(" "),o("p",[e._v("An example Node using password storage:")]),e._v(" "),o("div",{staticClass:"language-{.xml .numberLines} extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v('<node name="egon" description="egon" osFamily="unix"\n    username="rundeck"\n    hostname="egon"\n    ssh-authentication="password"\n    ssh-password-storage-path="keys/projects/${job.project}/nodes/${node.name}/rundeck.password" />\n')])])]),o("h3",{attrs:{id:"secondary-sudo-password-authentication"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#secondary-sudo-password-authentication","aria-hidden":"true"}},[e._v("#")]),e._v(" Secondary Sudo Password Authentication")]),e._v(" "),o("p",[e._v('The SSH provider supports a secondary authentication mechanism: Sudo password authentication. This is useful if your security requirements are such that you require the SSH connection to be under a specific user\'s account instead of a generic "rundeck" account, and you still need to allow "sudo" level commands to be executed requiring a password to be entered.')]),e._v(" "),o("p",[e._v("This works in the following way:")]),e._v(" "),o("ul",[o("li",[e._v('After connecting to the remote node via SSH, a command requiring "sudo" authentication is issued, such as "sudo -u otheruser /sbin/some-command"')]),e._v(" "),o("li",[e._v("The remote node will prompt for a sudo password, expecting user input")]),e._v(" "),o("li",[e._v("The SSH Provider will write the password to the remote node")]),e._v(" "),o("li",[e._v("The sudo command will execute as if a user had entered the command")])]),e._v(" "),o("p",[e._v("The Sudo password(s) can be provided in two ways:")]),e._v(" "),o("ul",[o("li",[o("a",{attrs:{href:"#sudo-password-as-a-job-option"}},[e._v("Sudo Password as a Job Option")])]),e._v(" "),o("li",[o("a",{attrs:{href:"#sudo-password-storage"}},[e._v("Sudo Password Storage")])])]),e._v(" "),o("p",[e._v("To enable Sudo Password Authentication, set the "),o("code",[e._v("sudo-command-enabled")]),e._v(" property/attribute to "),o("code",[e._v("true")]),e._v(".")]),e._v(" "),o("p",[e._v("You can configure the way the Sudo Password Authentication works by setting these properties at the Node, Project or Rundeck scopes. Simply set the attribute name on a Node, the "),o("code",[e._v("project.NAME")]),e._v(" in project.properties, or "),o("code",[e._v("framework.NAME")]),e._v(" in framework.properties:")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("sudo-command-enabled")]),e._v(' - set to "true" to enable Sudo Password Authentication.')]),e._v(" "),o("li",[o("code",[e._v("sudo-command-pattern")]),e._v(" - a regular expression to detect when a command execution should expect to require Sudo authentication. Default pattern is "),o("code",[e._v("^sudo$")]),e._v(".")]),e._v(" "),o("li",[o("code",[e._v("sudo-password-option")]),e._v(' - an option reference ("option.NAME") to define which secure remote authentication option value to use as password. The default is '),o("code",[e._v("option.sudoPassword")]),e._v(".")]),e._v(" "),o("li",[o("code",[e._v("sudo-password-storage-path")]),e._v(" - Path in the Key Storage facility for the password.")]),e._v(" "),o("li",[o("code",[e._v("sudo-prompt-pattern")]),e._v(" - a regular expression to detect the password prompt for the Sudo authentication. The default pattern is "),o("code",[e._v("^\\[sudo\\] password for .+: .*")])]),e._v(" "),o("li",[o("code",[e._v("sudo-failure-pattern")]),e._v(" - a regular expression to detect the password failure response. The default pattern is "),o("code",[e._v("^.*try again.*")]),e._v(".")]),e._v(" "),o("li",[o("code",[e._v("sudo-prompt-max-lines")]),e._v(" - maximum lines to read when expecting the password prompt. (default: "),o("code",[e._v("12")]),e._v(").")]),e._v(" "),o("li",[o("code",[e._v("sudo-prompt-max-timeout")]),e._v(" - maximum milliseconds to wait for input when expecting the password prompt. (default "),o("code",[e._v("5000")]),e._v(")")]),e._v(" "),o("li",[o("code",[e._v("sudo-response-max-lines")]),e._v(" - maximum lines to read when looking for failure response. (default: "),o("code",[e._v("2")]),e._v(").")]),e._v(" "),o("li",[o("code",[e._v("sudo-response-max-timeout")]),e._v(" - maximum milliseconds to wait for response when detecting the failure response. (default "),o("code",[e._v("5000")]),e._v(")")]),e._v(" "),o("li",[o("code",[e._v("sudo-fail-on-prompt-max-lines")]),e._v(" - true/false. If true, fail execution if max lines are reached looking for password prompt. (default: "),o("code",[e._v("false")]),e._v(")")]),e._v(" "),o("li",[o("code",[e._v("sudo-success-on-prompt-threshold")]),e._v(" - true/false. If true, succeed (without writing password), if the input max lines are reached without detecting password prompt. (default: "),o("code",[e._v("true")]),e._v(").")]),e._v(" "),o("li",[o("code",[e._v("sudo-fail-on-prompt-timeout")]),e._v(" - true/false. If true, fail execution if timeout reached looking for password prompt. (default: "),o("code",[e._v("true")]),e._v(")")]),e._v(" "),o("li",[o("code",[e._v("sudo-fail-on-response-timeout")]),e._v(" - true/false. If true, fail on timeout looking for failure message. (default: "),o("code",[e._v("false")]),e._v(")")])]),e._v(" "),o("p",[e._v('Note: the default values have been set for the unix "sudo" command, but can be overridden if you need to customize the interaction.')]),e._v(" "),o("h4",{attrs:{id:"sudo-password-as-a-job-option"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#sudo-password-as-a-job-option","aria-hidden":"true"}},[e._v("#")]),e._v(" Sudo Password as a Job Option")]),e._v(" "),o("p",[e._v("Job Option Passwords for the nodes are input either via the GUI or arguments to the job if executed via CLI or API.")]),e._v(" "),o("p",[e._v("Configure a Job, and include an Option definition where "),o("code",[e._v("secureInput")]),e._v(" is set to "),o("code",[e._v("true")]),e._v(". The name of this option can be anything you want, but the default value of "),o("code",[e._v("sudoPassword")]),e._v(" recognized by the plugin can be used.")]),e._v(" "),o("p",[e._v("If the value is not "),o("code",[e._v("sudoPassword")]),e._v(", then make sure to set the following attribute on each Node for password authentication:")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("sudo-password-option")]),e._v(' = "'),o("code",[e._v("option.NAME")]),e._v("\" where NAME is the name of the Job's Secure Remote Authentication Option.")])]),e._v(" "),o("p",[e._v("An example Node and Job option configuration are below:")]),e._v(" "),o("div",{staticClass:"language-{.xml .numberLines} extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v('<node name="egon" description="egon" osFamily="unix"\n    username="rundeck"\n    hostname="egon"\n    sudo-command-enabled="true"\n    sudo-password-option="option.sudoPassword2" />\n')])])]),o("p",[e._v("Job:")]),e._v(" "),o("div",{staticClass:"language-{.xml .numberLines} extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("<joblist>\n    <job>\n         <sequence keepgoing='false' strategy='node-first'>\n          <command>\n            <exec>sudo apachectl restart</exec>\n          </command>\n        </sequence>\n\n        <context>\n          <project>project</project>\n          <options>\n            <option required='true' name='sudoPassword2' secure='true'\n                    description=\"Sudo authentication password\"/>\n          </options>\n        </context>\n        ...\n    </job>\n</joblist>\n")])])]),o("h4",{attrs:{id:"sudo-password-storage"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#sudo-password-storage","aria-hidden":"true"}},[e._v("#")]),e._v(" Sudo Password Storage")]),e._v(" "),o("p",[o("strong",[e._v("Note:")]),e._v(" See "),o("a",{attrs:{href:"#using-key-storage-for-ssh"}},[e._v("Using Key Storage for SSH")]),e._v(".")]),e._v(" "),o("p",[e._v("Define a "),o("code",[e._v("sudo-password-storage-path")]),e._v(" node attribute specifying the path in the Key Storage Facility for the password.")]),e._v(" "),o("p",[e._v("See example Node configuration below:")]),e._v(" "),o("div",{staticClass:"language-{.xml .numberLines} extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v('<node name="egon" description="egon" osFamily="unix"\n    username="rundeck"\n    hostname="egon"\n    sudo-command-enabled="true"\n    sudo-password-storage-path="keys/nodes/${node.name}/sudo.password" />\n')])])]),o("h3",{attrs:{id:"multiple-sudo-password-authentication"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#multiple-sudo-password-authentication","aria-hidden":"true"}},[e._v("#")]),e._v(" Multiple Sudo Password Authentication")]),e._v(" "),o("p",[e._v('You can enable a further level of sudo password support for a node. If you have\nthe requirement of executing a chain of "sudo" commands, such as "sudo -u user1\nsudo -u user2 command", and need to enable password input for both levels of\nsudo. This is possible by configuring a secondary set of properties for your\nnode/project/framework.')]),e._v(" "),o("p",[e._v("The configuration properties are the same as those for the first-level of sudo\npassword authentication described in "),o("a",{attrs:{href:"#secondary-sudo-password-authentication"}},[e._v("Configuring Secondary Sudo Password Authentication")]),e._v(', but with a\nprefix of "sudo2-" instead of "sudo-", such as:')]),e._v(" "),o("pre",[o("code",[e._v('sudo2-command-enabled="true"\nsudo2-command-pattern="^sudo .+? sudo .*$"\n')])]),e._v(" "),o("p",[e._v("This would turn on a mechanism to expect and respond to another sudo password\nprompt when the command matches the given pattern.")]),e._v(" "),o("p",[e._v('If a value for "sudo2-password-option" is not set, then a default value of\n'),o("code",[e._v("option.sudo2Password")]),e._v(" will be used.")]),e._v(" "),o("p",[o("strong",[e._v('A note about the "sudo2-command-pattern":')])]),e._v(" "),o("p",[e._v("The sudo authentication mechanism uses two regular expressions to test whether it should be\ninvoked.")]),e._v(" "),o("p",[e._v('For the first sudo authentication, the "sudo-command-pattern" value is matched against\nthe '),o("strong",[e._v("first component of the command being executed")]),e._v(". The default value for this pattern is "),o("code",[e._v("^sudo$")]),e._v('.\nSo a command like "sudo -u user1 some command" will match correctly. You can modify the\nregular expression (e.g. to support "su"), but it will always only match against the first\npart of the command.')]),e._v(" "),o("p",[e._v('If "sudo2-command-enabled" is "true", then the "sudo2-command-pattern" is also checked\nand if it matches then another sudo authentication is enabled.\nHowever this regular expression is tested against the '),o("strong",[e._v("entire command string")]),e._v("\nto make it possible to determine whether it should be enabled. The default value is\n"),o("code",[e._v("^sudo .+? sudo .*$")]),e._v(". If necessary you should customize the value.")]),e._v(" "),o("h3",{attrs:{id:"ssh-agent-support"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#ssh-agent-support","aria-hidden":"true"}},[e._v("#")]),e._v(" SSH Agent support")]),e._v(" "),o("p",[e._v("Note: "),o("strong",[e._v("Incubator feature")])]),e._v(" "),o("p",[e._v('This will start /usr/bin/ssh-agent on each command step execution\n(if enabled),\ninject the private key the job would normally use in the agent,\nmake the agent available on the newly created jsch connection\nand enable agent forwarding on the connection.\nOnce the job is done the ssh-agent is killed.\nOptionally ssh-agent can be started with "-t '),o("ttl",[e._v("\"\nwhich will guarantee the private key will be flushed at that time\nif by some chance it's not killed.")])],1),e._v(" "),o("p",[e._v("Obviously with this enabled you cannot rely on Rundeck to limit\nwhat hosts are accessible to your users,\nproper key management is required on all hosts.")]),e._v(" "),o("p",[e._v("New variables are:")]),e._v(" "),o("p",[o("strong",[e._v("framework.properties:")])]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("framework.local-ssh-agent=<true|false>\nframework.local-ttl-ssh-agent=<time in sec>\n")])])]),o("p",[o("strong",[e._v("project.properties:")])]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("project.local-ssh-agent=<true|false>\nproject.local-ttl-ssh-agent=<time in sec>\n")])])]),o("p",[o("strong",[e._v("Node attributes:")])]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("local-ssh-agent=<true|false>\nlocal-ttl-ssh-agent=<time in sec>\n")])])]),o("h2",{attrs:{id:"ssh-system-configuration"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#ssh-system-configuration","aria-hidden":"true"}},[e._v("#")]),e._v(" SSH System Configuration")]),e._v(" "),o("ul",[o("li",[e._v("The SSH configuration requires that the Rundeck server machine can\nssh commands to the client machines.")]),e._v(" "),o("li",[e._v("SSH is assumed to be installed and configured appropriately to allow\nthis access.")]),e._v(" "),o("li",[e._v("SSH can be configured for either "),o("em",[e._v("password")]),e._v(" based authentication or "),o("em",[e._v("public/private key")]),e._v(" based authentication.")]),e._v(" "),o("li",[e._v("For public/private key authentication:\n_ There are many resources\navailable on how to configure ssh to use public key authentication\ninstead of passwords such as:\n"),o("a",{attrs:{href:"https://debian-administration.org/article/152/Password-less_logins_with_OpenSSH",target:"_blank",rel:"noopener noreferrer"}},[e._v("Password-less logins with OpenSSH"),o("OutboundLink")],1),e._v("\n_ If your private key file has a passphrase, each Job definition that will execute on the node must be configured correctly.")]),e._v(" "),o("li",[e._v("For password authentication:\n"),o("ul",[o("li",[e._v("each Node definition must be configured to allow password authentication")]),e._v(" "),o("li",[e._v("each Job definition that will use it must be configured correctly")])])])]),e._v(" "),o("h3",{attrs:{id:"ssh-key-generation"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#ssh-key-generation","aria-hidden":"true"}},[e._v("#")]),e._v(" SSH key generation")]),e._v(" "),o("ul",[o("li",[e._v("The Rundeck installation can be configured to use RSA "),o("em",[e._v("or")]),e._v(" DSA\ntype keys.")])]),e._v(" "),o("p",[e._v("Here's an example of SSH RSA key generation on a Linux system:")]),e._v(" "),o("pre",[o("code",[e._v("$ ssh-keygen -t rsa\nGenerating public/private rsa key pair.\nEnter file in which to save the key (/home/demo/.ssh/id_rsa):\nEnter passphrase (empty for no passphrase):\nEnter same passphrase again:\nYour identification has been saved in /home/demo/.ssh/id_rsa.\nYour public key has been saved in /home/demo/.ssh/id_rsa.pub.\nThe key fingerprint is:\na7:31:01:ca:f0:62:42:9d:ab:c8:b7:9c:d1:80:76:c6 demo@ubuntu\nThe key's randomart image is:\n+--[ RSA 2048]----+\n| .o . .          |\n|.  * . .         |\n|. = =   .        |\n| = E     .       |\n|+ + o   S .      |\n|.o o .   =       |\n|  o +   .        |\n|   +             |\n|                 |\n+-----------------+\n")])]),e._v(" "),o("h3",{attrs:{id:"configuring-remote-machine-for-ssh"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#configuring-remote-machine-for-ssh","aria-hidden":"true"}},[e._v("#")]),e._v(" Configuring remote machine for SSH")]),e._v(" "),o("p",[e._v("To be able to directly ssh to remote machines, the SSH public key of\nthe client should be shared to the remote machine.")]),e._v(" "),o("p",[e._v("Follow the steps given below to enable ssh to remote machines.")]),e._v(" "),o("p",[e._v("The ssh public key should be copied to the "),o("code",[e._v("authorized_keys")]),e._v(" file of\nthe remote machine. The public key will be available in\n"),o("code",[e._v("~/.ssh/id_rsa.pub")]),e._v(" file.")]),e._v(" "),o("p",[e._v("The "),o("code",[e._v("authorized_keys")]),e._v(" file should be created in the "),o("code",[e._v(".ssh")]),e._v(" directory of\nthe remote machine.")]),e._v(" "),o("p",[e._v("The file permission of the authorized key should be read/write for\nthe user and nothing for group and others. To do this check the\npermission and change it as shown below.")]),e._v(" "),o("pre",[o("code",[e._v("$ cd ~/.ssh\n$ ls -la\n-rw-r--r--   1 raj  staff     0 Nov 22 18:14 authorized_keys\n\n$ chmod 600 authorized_keys\n$ ls -la\n-rw-------   1 raj  staff     0 Nov 22 18:14 authorized_keys\n")])]),e._v(" "),o("p",[e._v("The permission for the .ssh directory of the remote machine should\nbe read/write/execute for the user and nothing for the group and\nothers. To do this, check the permission and change it as shown\nbelow.")]),e._v(" "),o("pre",[o("code",[e._v("$ ls -la\ndrwxr-xr-x   2 raj  staff    68 Nov 22 18:19 .ssh\n$ chmod 700 .ssh\n$ ls -la\ndrwx------   2 raj  staff    68 Nov 22 18:19 .ssh\n")])]),e._v(" "),o("p",[e._v("If you are running Rundeck on Windows, we heartily recommend using\n"),o("a",{attrs:{href:"https://cygwin.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Cygwin"),o("OutboundLink")],1),e._v(" on Windows as it includes SSH and a number of\nUnix-like tools that are useful when you work in a command line\nenvironment.")]),e._v(" "),o("h3",{attrs:{id:"passing-environment-variables-through-remote-command"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#passing-environment-variables-through-remote-command","aria-hidden":"true"}},[e._v("#")]),e._v(" Passing environment variables through remote command")]),e._v(" "),o("p",[e._v("To pass environment variables through remote command\ndispatches, it is required to properly configure the SSH server on the\nremote end. See the "),o("code",[e._v("AcceptEnv")]),e._v(' directive in the "sshd_config(5)"\nmanual page for instructions.')]),e._v(" "),o("p",[e._v("Use a wild card pattern to permit "),o("code",[e._v("RD_")]),e._v(" prefixed variables to provide\nopen access to Rundeck generated environment variables.")]),e._v(" "),o("p",[e._v("Example in sshd_config:")]),e._v(" "),o("pre",[o("code",[e._v("# pass Rundeck variables\nAcceptEnv RD_*\n")])])])},[],!1,null,null,null);t.default=a.exports}}]);