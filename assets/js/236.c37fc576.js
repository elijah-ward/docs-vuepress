(window.webpackJsonp=window.webpackJsonp||[]).push([[236],{203:function(e,a,t){"use strict";t.r(a);var n=t(0),o=Object(n.a)({},function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"aclpolicy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#aclpolicy","aria-hidden":"true"}},[e._v("#")]),e._v(" ACLPOLICY")]),e._v(" "),t("p",[e._v("Updated December 20, 2013")]),e._v(" "),t("h1",{attrs:{id:"overview"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#overview","aria-hidden":"true"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),t("p",[e._v("This document describes the YAML format for ACL Policy definition files.")]),e._v(" "),t("p",[e._v("Multiple aclpolicy files can be stored in the\nsame directory, helping the management of each set of rules. This\nreduces the complexity of each file. The default path is")]),e._v(" "),t("ul",[t("li",[e._v("RPM install: "),t("code",[e._v("/etc/rundeck")])]),e._v(" "),t("li",[e._v("Launcher install: "),t("code",[e._v("$RDECK_BASE/etc")])])]),e._v(" "),t("p",[e._v("Policy files are parsed using YAML and while the structure is rigid,\nadditional information can be added and safely ignored. So creating arbitrary\nelements for documentation or organizational purposes is gracefully parsed.\nThe resulting file must be a valid yaml file.")]),e._v(" "),t("p",[e._v("For more information about the exact resources and actions you need to\nauthorize for the Rundeck application, see the\n[Administration Guide - Authorization](/administration/security/authorization.md#rundeck-resource-authorizations].")]),e._v(" "),t("h2",{attrs:{id:"authorizing-a-certain-action-on-a-resource"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#authorizing-a-certain-action-on-a-resource","aria-hidden":"true"}},[e._v("#")]),e._v(" Authorizing a certain action on a resource")]),e._v(" "),t("p",[e._v("The aclpolicy describes actions that are allowed or denied on certain resources.")]),e._v(" "),t("p",[e._v("The method for determining whether a user has access to perform such an action\nhappens essentially in this way:")]),e._v(" "),t("ol",[t("li",[e._v("Look for policies matching the username or group for the user")]),e._v(" "),t("li",[e._v("Look for a context matching the environment of the given resource\n"),t("ul",[t("li",[e._v("either a specific project by name")]),e._v(" "),t("li",[e._v("or the application level")])])]),e._v(" "),t("li",[e._v("Look for a Type rule for the type of resource\n"),t("ul",[t("li",[e._v("either a specific resource by its named type")]),e._v(" "),t("li",[e._v('or the generic "resource"')])])]),e._v(" "),t("li",[e._v("Iterate through the rules for the type\n"),t("ul",[t("li",[e._v("if a rule matches, and allows the action, mark it and continue.")]),e._v(" "),t("li",[e._v("if a rule matches and denies the action, return DENIED, and stop")])])]),e._v(" "),t("li",[e._v("If it was DENIED, return DENIED. If it was marked, return ALLOWED. Otherwise\nif no rules matched, return REJECTED.")])]),e._v(" "),t("p",[e._v("Thus to allow an action, there has to be a matching rule that allows it, and\nno matching rule that denies it.")]),e._v(" "),t("h2",{attrs:{id:"changes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#changes","aria-hidden":"true"}},[e._v("#")]),e._v(" Changes")]),e._v(" "),t("p",[e._v("The YAML format has changed since version 1.2 to address several issues:")]),e._v(" "),t("ol",[t("li",[e._v("Access control on resources other than Jobs can now be declared")]),e._v(" "),t("li",[e._v("Project level access control is now supported")]),e._v(" "),t("li",[e._v('"Deny" rules can now be declared')]),e._v(" "),t("li",[e._v("Application level access control is also supported, replacing the Role mapping")])]),e._v(" "),t("p",[e._v("The Rundeck server no longer uses role-mapping and instead defers to the aclpolicy for all authorizations.")]),e._v(" "),t("h3",{attrs:{id:"in-version-1-5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#in-version-1-5","aria-hidden":"true"}},[e._v("#")]),e._v(" In version 1.5")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("by")]),e._v(" clause "),t("code",[e._v("username:")]),e._v(" and "),t("code",[e._v("group:")]),e._v(" now support regular expression matching")]),e._v(" "),t("li",[e._v("legacy XML support has been removed")]),e._v(" "),t("li",[e._v("legacy "),t("code",[e._v("rules:")]),e._v(" section in yaml support has been removed")])]),e._v(" "),t("h3",{attrs:{id:"in-version-3-1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#in-version-3-1","aria-hidden":"true"}},[e._v("#")]),e._v(" In version 3.1")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("notBy")]),e._v(" clause as a negative variant of "),t("code",[e._v("by")]),e._v(" clause")])]),e._v(" "),t("h2",{attrs:{id:"upgrading"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#upgrading","aria-hidden":"true"}},[e._v("#")]),e._v(" Upgrading")]),e._v(" "),t("p",[e._v("Note: The XML format from Rundeck 1.3 and earlier is no longer supported. As\nwell, the YAML format from 1.2 is now only partially supported.")]),e._v(" "),t("p",[e._v("If you are upgrading from Rundeck 1.3 or earlier, you will have to modify\nyour *.aclpolicy files.")]),e._v(" "),t("p",[e._v("If you have XML formatted files, you will need to remove and replace them with\na YAML document in the format described below. A full, admin-level ACL\nis described at the end of this document.")]),e._v(" "),t("p",[e._v("If you have YAML formatted files, you will also need to upgrade them slightly.")]),e._v(" "),t("h2",{attrs:{id:"the-aclpolicy-markup-by-example"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#the-aclpolicy-markup-by-example","aria-hidden":"true"}},[e._v("#")]),e._v(" The aclpolicy markup by example")]),e._v(" "),t("p",[e._v("An example policy document.")]),e._v(" "),t("div",{staticClass:"language-{.yaml .numberLines} extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("description: Yaml Policy 1\ncontext: # declares the context of the ACL\n  project: '.*' # applies to projects matching a regex.\nfor:\n  resource:\n     - equals:\n        kind: job\n       allow: '*'\n  job:\n     - allow: '*'\n     - match:\n         group: 'group1/.*'\n       deny: '*'\n\nby:\n    username: 'yml_usr_1'\n    group: ['yml_group_1','group2']\n")])])]),t("p",[e._v("An .aclpolicy supports multiple policy definitions in the form of YAML\ndocuments using the "),t("code",[e._v("---")]),e._v(" separator. There are four elements that make a\npolicy definition: "),t("code",[e._v("decription")]),e._v(", "),t("code",[e._v("context")]),e._v(", "),t("code",[e._v("for")]),e._v(", "),t("code",[e._v("by")]),e._v(".")]),e._v(" "),t("p",[e._v("It's recommended that this description be short and descriptive as it appears\nin the log output.")]),e._v(" "),t("h2",{attrs:{id:"context"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#context","aria-hidden":"true"}},[e._v("#")]),e._v(" "),t("code",[e._v("context")])]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("context")]),e._v(" section declares the scope of the ensuing policy description.")]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("context")]),e._v(" can contain one of two things:")]),e._v(" "),t("ol",[t("li",[t("code",[e._v("project")])]),e._v(" "),t("li",[t("code",[e._v("application")])])]),e._v(" "),t("p",[e._v("Declaring a "),t("code",[e._v("project:")]),e._v(" declares the name of the project(s) for which the policy\napplies. Its value is a String, and can be a regular expression, for which\nthe project name must match to apply.")]),e._v(" "),t("p",[e._v("If you declare an "),t("code",[e._v("application")]),e._v(" section, its only supported value is "),t("code",[e._v("rundeck")]),e._v(",\nas:\ncontext:\napplication: 'rundeck'")]),e._v(" "),t("p",[e._v("This declares that the policy document describes access control at the\napplication level, rather than for at a project level. You can then declare\naccess control on actions such as creating Projects.")]),e._v(" "),t("p",[e._v('Note that to provide a full "admin" level access control for a user or group,\nthen two policies must be defined, for application level as well as for project\nlevel.')]),e._v(" "),t("p",[t("strong",[e._v("NOTE")]),e._v(" if you are upgrading a yaml 1.2 format document, you will need to add\na "),t("code",[e._v("context")]),e._v(" section.")]),e._v(" "),t("h2",{attrs:{id:"for"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#for","aria-hidden":"true"}},[e._v("#")]),e._v(" "),t("code",[e._v("for")])]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("for")]),e._v(" section declares a set of resource types, each containing a sequence\nof matching rules which allow or deny certain actions.")]),e._v(" "),t("p",[e._v('Resource types declare the type of a specific resource for the match, and the generic\n"resource" is used to declare rules for all resources of a certain type.')]),e._v(" "),t("p",[e._v("Inside "),t("code",[e._v("for")]),e._v(" is an entry for any of these resource types:")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("job")]),e._v(" - a Rundeck Job")]),e._v(" "),t("li",[t("code",[e._v("node")]),e._v(" - a Node resource")]),e._v(" "),t("li",[t("code",[e._v("adhoc")]),e._v(" - an Ad-hoc execution")]),e._v(" "),t("li",[t("code",[e._v("project")]),e._v(" - a Project")]),e._v(" "),t("li",[t("code",[e._v("resource")]),e._v(" - indicates rules for all resources of a certain kind")])]),e._v(" "),t("p",[e._v("Within each type section is a sequence of rules. Recall that in YAML, a\nsequence is defined using multiple "),t("code",[e._v("-")]),e._v(" indicators, or within "),t("code",[e._v("[")]),e._v(" and "),t("code",[e._v("]")]),e._v(" and separated by commas.")]),e._v(" "),t("p",[e._v("Yaml sequences:")]),e._v(" "),t("div",{staticClass:"language-{.yaml} extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("    - a\n    - b\n")])])]),t("p",[e._v("also:")]),e._v(" "),t("div",{staticClass:"language-{.yaml} extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("    [ a, b ]\n")])])]),t("h3",{attrs:{id:"type-rules"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#type-rules","aria-hidden":"true"}},[e._v("#")]),e._v(" Type rules")]),e._v(" "),t("p",[e._v("Type rules are in the form:")]),e._v(" "),t("pre",[t("code",[e._v("matching*:\n property: value\nallow: actions\ndeny: actions\n")])]),e._v(" "),t("p",[e._v("Each rule has one or more of these Action entries:")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("allow")]),e._v(" - (List or String) - the actions allowed")]),e._v(" "),t("li",[t("code",[e._v("deny")]),e._v(" - (List or String) - the actions denied")])]),e._v(" "),t("p",[e._v('It also has one or more of these "Matching" entries:')]),e._v(" "),t("ul",[t("li",[t("code",[e._v("match")]),e._v(" - (List or String) - regular expression matches")]),e._v(" "),t("li",[t("code",[e._v("equals")]),e._v(" - (String) - equality matches")]),e._v(" "),t("li",[t("code",[e._v("contains")]),e._v(" - (List or String) - superset membership matches")]),e._v(" "),t("li",[t("code",[e._v("subset")]),e._v(" - (List or String) - subset membership matches")])]),e._v(" "),t("p",[e._v("Each Matching entry is composed of "),t("code",[e._v("property: value")]),e._v(", which declare what property\nof the resource to test, and what value or values to apply the matching rule to.")]),e._v(" "),t("p",[e._v('For example, to declare a rule for a resource with a "name" property of "bob"\nexactly, use '),t("code",[e._v("equals")]),e._v(":")]),e._v(" "),t("div",{staticClass:"language-{.yaml} extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("    equals:\n      name: bob\n    allow: [action1, action2]\n    deny: action3\n")])])]),t("p",[e._v("For regular expression matching, use "),t("code",[e._v("match")]),e._v(":")]),e._v(" "),t("div",{staticClass:"language-{.yaml} extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("    match:\n      name: 'bob|sam'\n")])])]),t("p",[e._v("For set membership matches, such as matching a Node that must have three\ndifferent tags, you can use "),t("code",[e._v("contains")])]),e._v(" "),t("div",{staticClass:"language-{.yaml} extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("    contains:\n      tags: [a,b,c]\n")])])]),t("p",[e._v("The "),t("code",[e._v("match")]),e._v(" and "),t("code",[e._v("contains")]),e._v(" allow a list of property values, and all of them\nmust match the resource's property for the rule to match. This allows the basic\nboolean AND logic. For OR logic, you can simply declare another rule in the\nsequence since all rules are checked (except in the case of an explicit deny).")]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("subset")]),e._v(" match allows a list of property values, and will fail if the resource\nhas any values "),t("em",[e._v("not")]),e._v(" included in the subset.")]),e._v(" "),t("h2",{attrs:{id:"by"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#by","aria-hidden":"true"}},[e._v("#")]),e._v(" "),t("code",[e._v("by")])]),e._v(" "),t("p",[e._v("Within "),t("code",[e._v("by")]),e._v(" are "),t("code",[e._v("username")]),e._v(" and "),t("code",[e._v("group")]),e._v(" entries that declare who the policy applies to.")]),e._v(" "),t("p",[e._v("Each entry can contain a single string, or a sequence of strings to define\nmultiple entries.")]),e._v(" "),t("p",[e._v("Regular expressions are supported in the username or group.")]),e._v(" "),t("p",[e._v("A single match will result in further evaluation of the policy.")]),e._v(" "),t("p",[e._v("Examples:")]),e._v(" "),t("div",{staticClass:"language-{.yaml} extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("    by:\n      username: 'bob'\n\n    by: #using a regular expression\n      username: 'dev\\d+'\n\n    by:\n      group: [test,qa,prod]\n\n    by: #using a regular expression\n      group: 'dev_team_(alpha|beta|gamma)'\n\n    by:\n      username:\n        - simon\n        - frank\n")])])]),t("h2",{attrs:{id:"notby"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#notby","aria-hidden":"true"}},[e._v("#")]),e._v(" "),t("code",[e._v("notBy")])]),e._v(" "),t("p",[t("code",[e._v("notBy")]),e._v(" is a variation of the "),t("code",[e._v("by")]),e._v(" clause that only works on "),t("code",[e._v("deny")]),e._v(", it follow the same pattern using "),t("code",[e._v("username")]),e._v(" and "),t("code",[e._v("group")]),e._v("\nentries but in this case, the policy applies to anyone not in the group or with a different username.")]),e._v(" "),t("p",[e._v("Each entry can contain a single string, or a sequence of strings to define\nmultiple entries.")]),e._v(" "),t("p",[e._v("Regular expressions are supported in the username or group.")]),e._v(" "),t("p",[e._v("Examples:")]),e._v(" "),t("div",{staticClass:"language-{.yaml} extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("    notBy:\n      username: 'bob'\n\n    notBy: #using a regular expression\n      username: 'dev\\d+'\n\n    notBy:\n      group: [test,qa,prod]\n\n    notBy: #using a regular expression\n      group: 'dev_team_(alpha|beta|gamma)'\n\n    notBy:\n      username:\n        - simon\n        - frank\n")])])]),t("h3",{attrs:{id:"actions-element"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#actions-element","aria-hidden":"true"}},[e._v("#")]),e._v(" "),t("code",[e._v("actions")]),e._v(" element")]),e._v(" "),t("p",[e._v("The actions element can be either a single value, or a list of values. A\nsingle value takes the form:")]),e._v(" "),t("pre",[t("code",[e._v("actions: 'an_action'\n")])]),e._v(" "),t("p",[e._v("And a list takes the form:")]),e._v(" "),t("pre",[t("code",[e._v("actions: ['an_action1','an_action2']\n")])]),e._v(" "),t("p",[e._v("Note that the single tick marks are optional according to the yaml\nspecification.")]),e._v(" "),t("p",[e._v("Possible values are limitless so it requires an understanding of the\njob definition you're trying to run. The best way to understand what\nthe actions are is to look at the rundeck-audit.log.\nThis will show all the options as they're being evaluated.")]),e._v(" "),t("h2",{attrs:{id:"example-admin-policy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example-admin-policy","aria-hidden":"true"}},[e._v("#")]),e._v(" Example Admin policy")]),e._v(" "),t("p",[e._v("This document grants full permissions to an 'admin' role:")]),e._v(" "),t("div",{staticClass:"language-{.yaml .numberLines} extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("description: Admin project level access control. Applies to resources within a specific project.\ncontext:\n  project: '.*' # all projects\nfor:\n  resource:\n    - equals:\n        kind: job\n      allow: [create] # allow create jobs\n    - equals:\n        kind: node\n      allow: [read,create,update,refresh] # allow refresh node sources\n    - equals:\n        kind: event\n      allow: [read,create] # allow read/create events\n  adhoc:\n    - allow: [read,run,runAs,kill,killAs] # allow running/killing adhoc jobs\n  job:\n    - allow: [create,read,update,delete,run,runAs,kill,killAs] # allow create/read/write/delete/run/kill of all jobs\n  node:\n    - allow: [read,run] # allow read/run for nodes\nby:\n  group: admin\n\n---\n\ndescription: Admin Application level access control, applies to creating/deleting projects, admin of user profiles, viewing projects and reading system information.\ncontext:\n  application: 'rundeck'\nfor:\n  resource:\n    - equals:\n        kind: project\n      allow: [create] # allow create of projects\n    - equals:\n        kind: system\n      allow: [read,enable_executions,disable_executions,admin] # allow read of system info, enable/disable all executions\n    - equals:\n        kind: system_acl\n      allow: [read,create,update,delete,admin] # allow modifying system ACL files\n    - equals:\n        kind: user\n      allow: [admin] # allow modify user profiles\n  project:\n    - match:\n        name: '.*'\n      allow: [read,import,export,configure,delete,admin] # allow full access of all projects or use 'admin'\n  project_acl:\n    - match:\n        name: '.*'\n      allow: [read,create,update,delete,admin] # allow modifying project-specific ACL files\n  storage:\n    - allow: [read,create,update,delete] # allow access for /ssh-key/* storage content\n\nby:\n  group: admin\n")])])])])},[],!1,null,null,null);a.default=o.exports}}]);